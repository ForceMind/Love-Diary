<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡ŒåŠ¨ç‚¹æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-panel {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .action-points {
            font-size: 24px;
            font-weight: bold;
            color: #2196f3;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>è¡ŒåŠ¨ç‚¹ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-panel">
        <h3>å½“å‰çŠ¶æ€</h3>
        <div class="action-points" id="actionPointsDisplay">è¡ŒåŠ¨ç‚¹: 0/0</div>
        <div>å½“å‰å‘¨: <span id="currentWeek">1</span></div>
        <div>å¹´çº§: <span id="currentGrade">1</span></div>
    </div>
    
    <div class="test-panel">
        <h3>æµ‹è¯•æ“ä½œ</h3>
        <button onclick="testStudyCourse()">å­¦ä¹ è¯¾ç¨‹ (æ¶ˆè€—2ç‚¹)</button>
        <button onclick="testRegularActivity()">å¸¸è§„æ´»åŠ¨ (æ¶ˆè€—1ç‚¹)</button>
        <button onclick="testDoubleDeduction()">ğŸ› æµ‹è¯•é‡å¤æ‰£é™¤é—®é¢˜</button>
        <button onclick="testNextWeek()">è¿›å…¥ä¸‹ä¸€å‘¨</button>
        <button onclick="testGradeUp()">æ¨¡æ‹Ÿå‡çº§</button>
        <button onclick="resetGame()">é‡ç½®æ¸¸æˆ</button>
    </div>
    
    <div class="test-panel">
        <h3>æµ‹è¯•æ—¥å¿—</h3>
        <div class="log" id="testLog"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ¸¸æˆçŠ¶æ€
        let gameState = {
            currentWeek: 1,
            actionPoints: 2,
            maxActionPoints: 2,
            player: { grade: 1 }
        };

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI() {
            document.getElementById('actionPointsDisplay').textContent = 
                `è¡ŒåŠ¨ç‚¹: ${gameState.actionPoints}/${gameState.maxActionPoints}`;
            document.getElementById('currentWeek').textContent = gameState.currentWeek;
            document.getElementById('currentGrade').textContent = gameState.player.grade;
            
            log(`UIæ›´æ–°: è¡ŒåŠ¨ç‚¹ ${gameState.actionPoints}/${gameState.maxActionPoints}, å‘¨ ${gameState.currentWeek}, å¹´çº§ ${gameState.player.grade}`);
        }

        // æ¨¡æ‹ŸfinishActivityæ–¹æ³•
        function finishActivity(actionPointCost = 1) {
            if (gameState.actionPoints >= actionPointCost) {
                gameState.actionPoints -= actionPointCost;
                log(`æ¶ˆè€— ${actionPointCost} è¡ŒåŠ¨ç‚¹ï¼Œå‰©ä½™ ${gameState.actionPoints}/${gameState.maxActionPoints}`);
                updateUI();
                return true;
            } else {
                log(`è¡ŒåŠ¨ç‚¹ä¸è¶³ï¼éœ€è¦ ${actionPointCost}ï¼Œå½“å‰åªæœ‰ ${gameState.actionPoints}`);
                return false;
            }
        }

        // æµ‹è¯•å­¦ä¹ è¯¾ç¨‹
        function testStudyCourse() {
            log('=== æµ‹è¯•å­¦ä¹ è¯¾ç¨‹ ===');
            const success = finishActivity(2); // è¯¾ç¨‹æ¶ˆè€—2ç‚¹
            if (success) {
                log('è¯¾ç¨‹å­¦ä¹ å®Œæˆ');
            }
        }

        // æµ‹è¯•å¸¸è§„æ´»åŠ¨
        function testRegularActivity() {
            log('=== æµ‹è¯•å¸¸è§„æ´»åŠ¨ ===');
            const success = finishActivity(1); // å¸¸è§„æ´»åŠ¨æ¶ˆè€—1ç‚¹
            if (success) {
                log('å¸¸è§„æ´»åŠ¨å®Œæˆ');
            }
        }

        // æµ‹è¯•è¿›å…¥ä¸‹ä¸€å‘¨
        function testNextWeek() {
            log('=== æµ‹è¯•è¿›å…¥ä¸‹ä¸€å‘¨ ===');
            gameState.currentWeek++;
            
            // æ£€æŸ¥å¹´çº§å‡çº§
            const newGrade = Math.min(4, Math.floor((gameState.currentWeek - 1) / 20) + 1);
            if (newGrade !== gameState.player.grade) {
                gameState.player.grade = newGrade;
                const gradeActionPoints = { 1: 2, 2: 3, 3: 5, 4: 7 };
                gameState.maxActionPoints = gradeActionPoints[newGrade];
                log(`å¹´çº§æå‡åˆ° ${newGrade}ï¼æœ€å¤§è¡ŒåŠ¨ç‚¹å¢åŠ åˆ° ${gameState.maxActionPoints}`);
            }
            
            // æ¢å¤è¡ŒåŠ¨ç‚¹
            gameState.actionPoints = gameState.maxActionPoints;
            log(`è¿›å…¥ç¬¬ ${gameState.currentWeek} å‘¨ï¼Œè¡ŒåŠ¨ç‚¹æ¢å¤åˆ° ${gameState.maxActionPoints}`);
            
            updateUI();
        }

        // æµ‹è¯•å¹´çº§æå‡
        function testGradeUp() {
            log('=== æµ‹è¯•å¹´çº§æå‡ ===');
            gameState.currentWeek = 21; // è·³åˆ°ç¬¬21å‘¨è§¦å‘å‡çº§
            gameState.player.grade = 2;
            const gradeActionPoints = { 1: 2, 2: 3, 3: 5, 4: 7 };
            gameState.maxActionPoints = gradeActionPoints[2];
            gameState.actionPoints = gameState.maxActionPoints;
            log(`æ¨¡æ‹Ÿå‡çº§åˆ°å¹´çº§ 2ï¼Œæœ€å¤§è¡ŒåŠ¨ç‚¹å˜ä¸º ${gameState.maxActionPoints}`);
            updateUI();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            log('=== é‡ç½®æ¸¸æˆ ===');
            gameState = {
                currentWeek: 1,
                actionPoints: 2,
                maxActionPoints: 2,
                player: { grade: 1 }
            };
            log('æ¸¸æˆçŠ¶æ€å·²é‡ç½®');
            updateUI();
        }

        // æµ‹è¯•é‡å¤æ‰£é™¤é—®é¢˜
        function testDoubleDeduction() {
            log('=== å¼€å§‹æµ‹è¯•é‡å¤æ‰£é™¤é—®é¢˜ ===');
            const initialPoints = gameState.actionPoints;
            log(`åˆå§‹è¡ŒåŠ¨ç‚¹: ${initialPoints}`);
            
            // æµ‹è¯•åœºæ™¯1: æ–°å‘¨æ´»åŠ¨ç³»ç»Ÿ
            log('åœºæ™¯1: æµ‹è¯•æ–°å‘¨æ´»åŠ¨ç³»ç»Ÿ (executeWeeklyActivity)');
            log('æ¨¡æ‹Ÿ: ç”¨æˆ·ç‚¹å‡»æ˜ŸæœŸä¸€ -> é€‰æ‹©å›¾ä¹¦é¦†å­¦ä¹ ');
            
            // æ¨¡æ‹Ÿæ–°å‘¨æ´»åŠ¨ç³»ç»Ÿçš„æµç¨‹
            log('æ­¥éª¤1: executeWeeklyActivity æ¶ˆè€—è¡ŒåŠ¨ç‚¹');
            gameState.actionPoints -= 1; // æ¨¡æ‹Ÿ executeWeeklyActivity æ¶ˆè€—
            const afterExecute = gameState.actionPoints;
            log(`executeWeeklyActivityåè¡ŒåŠ¨ç‚¹: ${afterExecute}`);
            
            // æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ç»§ç»­æŒ‰é’® - è¿™é‡Œä¸åº”è¯¥å†æ¬¡æ¶ˆè€—è¡ŒåŠ¨ç‚¹
            log('æ­¥éª¤2: ç”¨æˆ·ç‚¹å‡»ç»§ç»­æŒ‰é’® (åº”è¯¥ä¸å†æ¶ˆè€—è¡ŒåŠ¨ç‚¹)');
            // è¿™é‡Œåº”è¯¥è°ƒç”¨ completeActivityWithoutActionPoints() è€Œä¸æ˜¯ finishActivity()
            const afterContinue = gameState.actionPoints; // åº”è¯¥ä¿æŒä¸å˜
            log(`ç‚¹å‡»ç»§ç»­åè¡ŒåŠ¨ç‚¹: ${afterContinue}`);
            
            const totalCost = initialPoints - afterContinue;
            log(`æ€»è®¡æ¶ˆè€—: ${totalCost}ç‚¹ (æœŸæœ›: 1ç‚¹)`);
            
            if (totalCost === 1) {
                log('âœ… ä¿®å¤æˆåŠŸ: æ–°å‘¨æ´»åŠ¨ç³»ç»Ÿä¸å†é‡å¤æ‰£é™¤è¡ŒåŠ¨ç‚¹');
            } else {
                log('ï¿½ ä»æœ‰é—®é¢˜: è¡ŒåŠ¨ç‚¹æ¶ˆè€—ä¸æ­£ç¡®');
            }
            
            // é‡ç½®æµ‹è¯•
            gameState.actionPoints = gameState.maxActionPoints;
            
            // æµ‹è¯•åœºæ™¯2: æ—§æ´»åŠ¨ç³»ç»Ÿï¼ˆå¦‚æœè¿˜åœ¨ä½¿ç”¨ï¼‰
            log('åœºæ™¯2: æµ‹è¯•æ—§æ´»åŠ¨ç³»ç»Ÿå…¼å®¹æ€§');
            const initialPoints2 = gameState.actionPoints;
            
            log('æ¨¡æ‹Ÿæ—§ç³»ç»Ÿè°ƒç”¨ finishActivity(1)');
            const success = finishActivity(1);
            const afterOldSystem = gameState.actionPoints;
            const oldSystemCost = initialPoints2 - afterOldSystem;
            log(`æ—§ç³»ç»Ÿæ¶ˆè€—: ${oldSystemCost}ç‚¹ (æœŸæœ›: 1ç‚¹)`);
            
            if (oldSystemCost === 1) {
                log('âœ… æ—§ç³»ç»Ÿå·¥ä½œæ­£å¸¸');
            } else {
                log('âš ï¸ æ—§ç³»ç»Ÿå¯èƒ½æœ‰é—®é¢˜');
            }
            
            log('=== æµ‹è¯•ç»“æŸ ===');
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            log('è¡ŒåŠ¨ç‚¹ç³»ç»Ÿæµ‹è¯•å¯åŠ¨');
            updateUI();
        };
    </script>
</body>
</html>
